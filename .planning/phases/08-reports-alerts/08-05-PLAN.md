---
phase: 08-reports-alerts
plan: 05
type: execute
wave: 3
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - src/components/reports/income-bar-chart.tsx
  - src/components/reports/report-summary-card.tsx
  - src/components/reports/date-range-picker.tsx
autonomous: true

must_haves:
  truths:
    - "Bar chart shows income by payment method over time"
    - "Summary cards display totals for each metric"
    - "Date range picker allows custom date selection"
  artifacts:
    - path: "src/components/reports/income-bar-chart.tsx"
      provides: "Stacked bar chart with Recharts"
      contains: "use client"
      min_lines: 50
    - path: "src/components/reports/report-summary-card.tsx"
      provides: "Summary card with value and label"
      min_lines: 20
    - path: "src/components/reports/date-range-picker.tsx"
      provides: "Date picker for report filtering"
      min_lines: 40
  key_links:
    - from: "src/components/reports/income-bar-chart.tsx"
      to: "recharts"
      via: "BarChart component"
      pattern: "BarChart"
    - from: "src/components/reports/income-bar-chart.tsx"
      to: "src/components/ui/chart.tsx"
      via: "ChartContainer"
      pattern: "ChartContainer"
---

<objective>
Create report visualization components: bar chart, summary cards, and date picker.

Purpose: Provides visual representation of financial data for Admin/Medico, enabling analysis of income by payment method and date range.
Output: Chart components ready for reports page integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-reports-alerts/08-CONTEXT.md
@.planning/phases/08-reports-alerts/08-RESEARCH.md

# Prior phase outputs
@.planning/phases/08-reports-alerts/08-01-SUMMARY.md (chart component installed)
@.planning/phases/08-reports-alerts/08-02-SUMMARY.md (types)
@.planning/phases/08-reports-alerts/08-03-SUMMARY.md (queries)

# Existing components
@src/components/ui/chart.tsx (ChartContainer, ChartTooltip, etc.)
@src/components/ui/card.tsx (Card component)
@src/components/ui/button.tsx (Button component)
@src/components/ui/popover.tsx (Popover for date picker)
@src/components/ui/calendar.tsx (Calendar component if exists, otherwise use input type date)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create income bar chart component</name>
  <files>src/components/reports/income-bar-chart.tsx</files>
  <action>
Create src/components/reports/income-bar-chart.tsx ('use client'):

1. Import from recharts: Bar, BarChart, CartesianGrid, XAxis, YAxis, Tooltip
2. Import from '@/components/ui/chart': ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, type ChartConfig
3. Import DailyIncomeData from '@/types/reports'
4. Import formatCurrency from '@/types/reports'

5. Define chartConfig (satisfies ChartConfig):
```typescript
const chartConfig = {
  efectivo: {
    label: "Efectivo",
    color: "hsl(var(--chart-1))",
  },
  tarjeta: {
    label: "Tarjeta",
    color: "hsl(var(--chart-2))",
  },
  transferencia: {
    label: "Transferencia",
    color: "hsl(var(--chart-3))",
  },
  nequi: {
    label: "Nequi",
    color: "hsl(var(--chart-4))",
  },
} satisfies ChartConfig
```

6. Props: { data: DailyIncomeData[] }

7. Component renders:
   - ChartContainer with config and className="min-h-[350px] w-full"
   - BarChart with data (transform fecha to display format if needed)
   - CartesianGrid vertical={false}
   - XAxis dataKey="fecha" with tickFormatter for date display (dd/MM)
   - YAxis with tickFormatter using formatCurrency
   - ChartTooltip with custom formatter for currency
   - ChartLegend
   - Four Bar components (efectivo, tarjeta, transferencia, nequi) with stackId="income" for stacked bars
   - Each Bar uses fill="var(--color-{key})"

8. If data is empty, show "No hay datos para mostrar" centered message
  </action>
  <verify>
- File exists: `ls src/components/reports/income-bar-chart.tsx`
- Has 'use client': `grep "'use client'" src/components/reports/income-bar-chart.tsx`
- Uses ChartContainer: `grep "ChartContainer" src/components/reports/income-bar-chart.tsx`
- Uses BarChart: `grep "BarChart" src/components/reports/income-bar-chart.tsx`
- Has chartConfig: `grep "chartConfig" src/components/reports/income-bar-chart.tsx`
- Has stacked bars: `grep "stackId" src/components/reports/income-bar-chart.tsx`
  </verify>
  <done>Income bar chart component created with stacked bars by payment method</done>
</task>

<task type="auto">
  <name>Task 2: Create report summary card component</name>
  <files>src/components/reports/report-summary-card.tsx</files>
  <action>
Create src/components/reports/report-summary-card.tsx:

1. Import Card, CardContent, CardHeader, CardTitle from '@/components/ui/card'
2. Import LucideIcon type from 'lucide-react' (optional, can use ReactNode for icon)

3. Props interface:
   - title: string
   - value: string (pre-formatted)
   - subtitle?: string
   - icon?: React.ReactNode
   - variant?: 'default' | 'success' | 'warning' | 'danger'

4. Component renders:
   - Card with variant-based border color:
     - default: no extra styling
     - success: border-green-500
     - warning: border-yellow-500
     - danger: border-red-500
   - CardHeader with flex row, icon on left, title on right
   - CardContent with value (text-2xl font-bold) and optional subtitle (text-sm text-muted-foreground)

5. No 'use client' needed (stateless, can be server component)
  </action>
  <verify>
- File exists: `ls src/components/reports/report-summary-card.tsx`
- Has Card: `grep "Card" src/components/reports/report-summary-card.tsx`
- Has Props interface: `grep "interface" src/components/reports/report-summary-card.tsx`
- Has variant styling: `grep "variant" src/components/reports/report-summary-card.tsx`
  </verify>
  <done>Report summary card component created with variant styling</done>
</task>

<task type="auto">
  <name>Task 3: Create date range picker component</name>
  <files>src/components/reports/date-range-picker.tsx</files>
  <action>
Create src/components/reports/date-range-picker.tsx ('use client'):

1. Import useState from 'react'
2. Import Button from '@/components/ui/button'
3. Import Calendar icon from 'lucide-react'
4. Import ReportPeriod from '@/types/reports'
5. Import format, startOfMonth, endOfMonth, startOfDay, endOfDay, subDays from 'date-fns'

6. Props interface:
   - onRangeChange: (startDate: string, endDate: string) => void
   - initialPeriod?: ReportPeriod

7. Component state:
   - period: ReportPeriod ('diario' | 'mensual' | 'rango')
   - startDate: string (YYYY-MM-DD)
   - endDate: string (YYYY-MM-DD)

8. Render:
   - Button group for period selection (Diario, Mensual, Rango)
   - Active button highlighted with variant="default", others variant="outline"

   When period changes:
   - 'diario': startDate = today, endDate = today
   - 'mensual': startDate = first of month, endDate = last of month
   - 'rango': show two date inputs

   - For 'rango', show two input type="date" elements
   - Apply button to trigger onRangeChange

9. Use useEffect to call onRangeChange when period or dates change (for diario/mensual)
   For 'rango', only call on Apply button click

Date formatting: Use format(date, 'yyyy-MM-dd') for input values
  </action>
  <verify>
- File exists: `ls src/components/reports/date-range-picker.tsx`
- Has 'use client': `grep "'use client'" src/components/reports/date-range-picker.tsx`
- Has period buttons: `grep -c "'diario'\|'mensual'\|'rango'" src/components/reports/date-range-picker.tsx` shows 3+
- Has date inputs: `grep "type=\"date\"" src/components/reports/date-range-picker.tsx`
- Has onRangeChange: `grep "onRangeChange" src/components/reports/date-range-picker.tsx`
  </verify>
  <done>Date range picker component created with period selection and custom range</done>
</task>

</tasks>

<verification>
1. All components type-check: `npx tsc --noEmit src/components/reports/*.tsx`
2. Chart imports from recharts resolve
3. ChartContainer works with chartConfig
4. DateRangePicker produces valid YYYY-MM-DD dates
</verification>

<success_criteria>
- src/components/reports/income-bar-chart.tsx: Stacked bar chart with 4 payment methods
- src/components/reports/report-summary-card.tsx: Variant-styled card with icon and value
- src/components/reports/date-range-picker.tsx: Period buttons (diario/mensual/rango) with date inputs
- Chart uses CSS variables --chart-1 through --chart-4
- All components are type-safe with proper interfaces
</success_criteria>

<output>
After completion, create `.planning/phases/08-reports-alerts/08-05-SUMMARY.md`
</output>
