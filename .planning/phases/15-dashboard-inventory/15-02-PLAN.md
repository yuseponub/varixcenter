---
phase: 15-dashboard-inventory
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/types/medias/dashboard.ts
  - src/lib/validations/medias/adjustment.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard metrics type defines efectivo, ventas, devoluciones pendientes"
    - "Adjustment schema validates product_id, cantidad, tipo, stock_type, razon"
    - "Razon requires minimum 10 characters"
  artifacts:
    - path: "src/types/medias/dashboard.ts"
      provides: "DashboardMetrics, LowStockProduct types"
      min_lines: 20
    - path: "src/lib/validations/medias/adjustment.ts"
      provides: "adjustmentSchema"
      exports: ["adjustmentSchema"]
  key_links:
    - from: "src/lib/validations/medias/adjustment.ts"
      to: "RPC params"
      via: "matches p_tipo and p_stock_type values"
      pattern: "entrada.*salida.*normal.*devoluciones"
---

<objective>
Create TypeScript types for dashboard metrics and Zod validation schema for inventory adjustments.

Purpose: Enable type-safe dashboard data and validated adjustment form submissions.
Output: Dashboard types file and adjustment validation schema.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-dashboard-inventory/15-CONTEXT.md
@.planning/phases/15-dashboard-inventory/15-RESEARCH.md
@src/types/medias/products.ts
@src/lib/validations/medias/products.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard types</name>
  <files>src/types/medias/dashboard.ts</files>
  <action>
Create src/types/medias/dashboard.ts with:

1. DashboardMetrics interface:
   - efectivo_en_caja: number (cash available from today's open cierre or 0)
   - ventas_hoy_count: number
   - ventas_hoy_total: number
   - ventas_mes_count: number
   - ventas_mes_total: number
   - devoluciones_pendientes: number

2. LowStockProduct interface:
   - id: string
   - codigo: string
   - tipo: MediasProductType
   - talla: MediasProductSize
   - stock_normal: number
   - umbral_alerta: number

3. StockAlertsSummary interface:
   - critical_count: number
   - products: LowStockProduct[]

4. AdjustmentType const and type:
   - const ADJUSTMENT_TYPES = ['entrada', 'salida'] as const
   - type AdjustmentType = (typeof ADJUSTMENT_TYPES)[number]

5. StockType const and type:
   - const STOCK_TYPES = ['normal', 'devoluciones'] as const
   - type StockType = (typeof STOCK_TYPES)[number]

6. AdjustmentResult interface (RPC response):
   - success: boolean
   - movement_id: string
   - stock_normal: number
   - stock_devoluciones: number

Import MediasProductType and MediasProductSize from products.ts.
  </action>
  <verify>Run `cat src/types/medias/dashboard.ts` to confirm all interfaces and types defined</verify>
  <done>Dashboard types file exists with DashboardMetrics, LowStockProduct, StockAlertsSummary, adjustment types, and AdjustmentResult</done>
</task>

<task type="auto">
  <name>Task 2: Create adjustment validation schema</name>
  <files>src/lib/validations/medias/adjustment.ts</files>
  <action>
Create src/lib/validations/medias/adjustment.ts with:

1. Import z from 'zod'
2. Import ADJUSTMENT_TYPES, STOCK_TYPES from '@/types/medias/dashboard'

3. adjustmentSchema with fields:
   - product_id: z.string().uuid()
   - cantidad: z.coerce.number().int().positive()
   - tipo: z.enum(ADJUSTMENT_TYPES) // 'entrada' or 'salida'
   - stock_type: z.enum(STOCK_TYPES) // 'normal' or 'devoluciones'
   - razon: z.string().min(10, 'La razon debe tener al menos 10 caracteres')

4. Export adjustmentSchema and type AdjustmentFormData = z.infer<typeof adjustmentSchema>

Use Zod v4 syntax (no required_error in options, just message in min/max).
  </action>
  <verify>Run `cat src/lib/validations/medias/adjustment.ts` to confirm schema validates all fields with proper constraints</verify>
  <done>Adjustment validation schema exists with product_id, cantidad, tipo, stock_type, and razon (min 10 chars)</done>
</task>

</tasks>

<verification>
- [ ] src/types/medias/dashboard.ts exists with all types
- [ ] DashboardMetrics has efectivo_en_caja, ventas counts/totals, devoluciones_pendientes
- [ ] LowStockProduct has id, codigo, tipo, talla, stock_normal, umbral_alerta
- [ ] ADJUSTMENT_TYPES and STOCK_TYPES constants exported
- [ ] src/lib/validations/medias/adjustment.ts exists
- [ ] adjustmentSchema validates all RPC parameters
- [ ] razon requires minimum 10 characters
</verification>

<success_criteria>
Types and validation schema ready for dashboard queries and adjustment form.
</success_criteria>

<output>
After completion, create `.planning/phases/15-dashboard-inventory/15-02-SUMMARY.md`
</output>
