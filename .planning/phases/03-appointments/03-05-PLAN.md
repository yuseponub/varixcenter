---
phase: 03-appointments
plan: 05
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - src/components/appointments/appointment-calendar.tsx
  - src/components/appointments/doctor-filter.tsx
  - src/components/appointments/status-badge.tsx
autonomous: true

must_haves:
  truths:
    - "Calendar displays appointments in day and week views (APT-01)"
    - "Doctor filter dropdown shows available medicos (APT-02)"
    - "Status badge shows colored indicator with Spanish label"
  artifacts:
    - path: "src/components/appointments/appointment-calendar.tsx"
      provides: "FullCalendar wrapper component"
      contains: "'use client'"
    - path: "src/components/appointments/doctor-filter.tsx"
      provides: "Doctor selection dropdown"
      contains: "SelectTrigger"
    - path: "src/components/appointments/status-badge.tsx"
      provides: "Status display badge"
      contains: "STATUS_COLORS"
  key_links:
    - from: "src/components/appointments/appointment-calendar.tsx"
      to: "@fullcalendar/react"
      via: "import"
      pattern: "import FullCalendar"
    - from: "src/components/appointments/status-badge.tsx"
      to: "state-machine"
      via: "import"
      pattern: "import.*STATUS_LABELS"
---

<objective>
Create calendar UI components: FullCalendar wrapper, doctor filter dropdown, and status badge.

Purpose: Build the reusable UI components that the calendar page will compose together.
Output: Client components ready for calendar page integration with proper event handling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-appointments/03-RESEARCH.md
@.planning/phases/03-appointments/03-CONTEXT.md
@src/components/ui/select.tsx
@src/types/appointments.ts
@src/lib/appointments/state-machine.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FullCalendar wrapper component</name>
  <files>src/components/appointments/appointment-calendar.tsx</files>
  <action>
Create directory and file `src/components/appointments/appointment-calendar.tsx`:

```typescript
'use client'

import { useRef, useCallback } from 'react'
import FullCalendar from '@fullcalendar/react'
import timeGridPlugin from '@fullcalendar/timegrid'
import dayGridPlugin from '@fullcalendar/daygrid'
import interactionPlugin from '@fullcalendar/interaction'
import esLocale from '@fullcalendar/core/locales/es'
import type {
  EventClickArg,
  DateSelectArg,
  EventDropArg,
  DatesSetArg
} from '@fullcalendar/core'
import { CalendarEvent } from '@/types/appointments'

interface AppointmentCalendarProps {
  events: CalendarEvent[]
  onEventClick: (eventId: string) => void
  onDateSelect: (start: Date, end: Date) => void
  onEventDrop: (eventId: string, newStart: string, newEnd: string) => void
  onDatesChange: (start: string, end: string) => void
}

/**
 * FullCalendar wrapper component for appointments
 *
 * Features (from CONTEXT.md and RESEARCH.md):
 * - Day and week views (APT-01)
 * - Drag-and-drop enabled for tablets
 * - Spanish locale
 * - Business hours 8am-6pm, Mon-Sat
 * - Touch support with 300ms long press delay
 */
export function AppointmentCalendar({
  events,
  onEventClick,
  onDateSelect,
  onEventDrop,
  onDatesChange
}: AppointmentCalendarProps) {
  const calendarRef = useRef<FullCalendar>(null)

  const handleEventClick = useCallback((info: EventClickArg) => {
    onEventClick(info.event.id)
  }, [onEventClick])

  const handleDateSelect = useCallback((info: DateSelectArg) => {
    onDateSelect(info.start, info.end)
  }, [onDateSelect])

  const handleEventDrop = useCallback((info: EventDropArg) => {
    const event = info.event
    onEventDrop(
      event.id,
      event.start?.toISOString() || '',
      event.end?.toISOString() || ''
    )
  }, [onEventDrop])

  const handleDatesSet = useCallback((info: DatesSetArg) => {
    onDatesChange(
      info.start.toISOString(),
      info.end.toISOString()
    )
  }, [onDatesChange])

  return (
    <div className="bg-white rounded-lg border p-4">
      <FullCalendar
        ref={calendarRef}
        plugins={[timeGridPlugin, dayGridPlugin, interactionPlugin]}
        initialView="timeGridWeek"
        locale={esLocale}
        headerToolbar={{
          left: 'prev,next today',
          center: 'title',
          right: 'timeGridWeek,timeGridDay'
        }}
        // Business hours (8am-6pm, Mon-Sat per CONTEXT.md assumptions)
        slotMinTime="08:00:00"
        slotMaxTime="18:00:00"
        slotDuration="00:15:00"
        slotLabelInterval="00:30:00"
        hiddenDays={[0]} // Hide Sunday
        // Interaction (drag-drop per CONTEXT.md)
        editable={true}
        selectable={true}
        selectMirror={true}
        // Touch support for tablets (per RESEARCH.md)
        longPressDelay={300}
        eventLongPressDelay={300}
        selectLongPressDelay={300}
        // Prevent visual overlaps (DB constraint handles actual prevention)
        eventOverlap={false}
        // Events
        events={events}
        eventClick={handleEventClick}
        select={handleDateSelect}
        eventDrop={handleEventDrop}
        datesSet={handleDatesSet}
        // Styling
        height="auto"
        nowIndicator={true}
        allDaySlot={false}
        // Week starts on Monday
        firstDay={1}
        // Event display
        eventTimeFormat={{
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        }}
        slotLabelFormat={{
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        }}
      />
    </div>
  )
}
```
  </action>
  <verify>
- File exists at `src/components/appointments/appointment-calendar.tsx`
- File has 'use client' directive at top
- `npm run build` passes (FullCalendar imports work)
  </verify>
  <done>
- FullCalendar wrapper with day/week views (APT-01)
- Drag-drop enabled with 300ms long press for tablets
- Spanish locale (esLocale)
- Business hours 8am-6pm, Sunday hidden
- Callbacks for event click, date select, event drop, dates change
  </done>
</task>

<task type="auto">
  <name>Task 2: Create doctor filter component</name>
  <files>src/components/appointments/doctor-filter.tsx</files>
  <action>
Create `src/components/appointments/doctor-filter.tsx`:

```typescript
'use client'

import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Doctor } from '@/types/appointments'

interface DoctorFilterProps {
  doctors: Doctor[]
  value: string | null
  onChange: (doctorId: string | null) => void
}

/**
 * Doctor filter dropdown for APT-02
 *
 * Allows filtering calendar by medico (Dr. Ciro, Dra. Carolina)
 */
export function DoctorFilter({ doctors, value, onChange }: DoctorFilterProps) {
  return (
    <div className="flex items-center gap-2">
      <label className="text-sm font-medium text-gray-700">
        Filtrar por medico:
      </label>
      <Select
        value={value || 'all'}
        onValueChange={(v) => onChange(v === 'all' ? null : v)}
      >
        <SelectTrigger className="w-[200px]">
          <SelectValue placeholder="Seleccionar medico" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">Todos los medicos</SelectItem>
          {doctors.map((doctor) => (
            <SelectItem key={doctor.id} value={doctor.id}>
              {doctor.nombre}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  )
}
```
  </action>
  <verify>
- File exists at `src/components/appointments/doctor-filter.tsx`
- Uses shadcn/ui Select component
- `npm run build` passes
  </verify>
  <done>
- Doctor filter dropdown using shadcn/ui Select
- "Todos los medicos" option for no filter
- Spanish label "Filtrar por medico"
- onChange returns null for "all", doctor ID otherwise
  </done>
</task>

<task type="auto">
  <name>Task 3: Create status badge component</name>
  <files>src/components/appointments/status-badge.tsx</files>
  <action>
Create `src/components/appointments/status-badge.tsx`:

```typescript
import { cn } from '@/lib/utils'
import { AppointmentStatus } from '@/types/appointments'
import {
  STATUS_LABELS,
  STATUS_COLORS
} from '@/lib/appointments/state-machine'

interface StatusBadgeProps {
  status: AppointmentStatus
  className?: string
}

/**
 * Status badge component for displaying appointment status
 *
 * Colors follow conventional meanings:
 * - Blue: programada (scheduled)
 * - Green: confirmada (confirmed)
 * - Yellow: en_sala (in waiting room)
 * - Purple: en_atencion (being attended)
 * - Gray: completada (completed)
 * - Red: cancelada (cancelled)
 * - Orange: no_asistio (no-show)
 */
export function StatusBadge({ status, className }: StatusBadgeProps) {
  return (
    <span
      className={cn(
        'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium',
        STATUS_COLORS[status],
        className
      )}
    >
      {STATUS_LABELS[status]}
    </span>
  )
}
```
  </action>
  <verify>
- File exists at `src/components/appointments/status-badge.tsx`
- Uses STATUS_LABELS and STATUS_COLORS from state-machine
- `npm run build` passes
  </verify>
  <done>
- StatusBadge displays colored badge with Spanish label
- Uses Tailwind classes from state-machine
- Accepts optional className for customization
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. appointment-calendar.tsx has 'use client' directive
3. All components use existing shadcn/ui and utility patterns
4. Spanish text used throughout (labels, placeholders)
</verification>

<success_criteria>
- Calendar shows day and week views with Spanish locale (APT-01)
- Doctor filter dropdown ready for APT-02
- Status badge displays all 7 states with appropriate colors
- Touch-friendly with 300ms long press delay
- Components ready for composition in calendar page
</success_criteria>

<output>
After completion, create `.planning/phases/03-appointments/03-05-SUMMARY.md`
</output>
