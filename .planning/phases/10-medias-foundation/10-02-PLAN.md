---
phase: 10-medias-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/medias/products.ts
  - src/lib/validations/medias/product.ts
autonomous: true

must_haves:
  truths:
    - "MediasProduct type matches database schema exactly"
    - "MediasStockMovement type includes before/after snapshots"
    - "Zod schema validates tipo, talla, codigo, precio fields"
  artifacts:
    - path: "src/types/medias/products.ts"
      provides: "Product and movement type definitions"
      exports: ["MediasProduct", "MediasStockMovement", "MOVEMENT_TYPES"]
    - path: "src/lib/validations/medias/product.ts"
      provides: "Zod validation schemas"
      exports: ["mediasProductSchema", "MediasProductFormData"]
  key_links:
    - from: "src/lib/validations/medias/product.ts"
      to: "zod"
      via: "import { z }"
      pattern: "import.*z.*from.*zod"
---

<objective>
Create TypeScript types and Zod validation schemas for medias products

Purpose: Enable type-safe development and form validation for product management
Output: Type definitions and Zod schemas following existing services patterns
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-medias-foundation/10-RESEARCH.md

# Pattern references
@src/types/services.ts
@src/lib/validations/service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create product and movement type definitions</name>
  <files>src/types/medias/products.ts</files>
  <action>
Create directory src/types/medias/ if needed, then create products.ts:

```typescript
/**
 * Medias Product Type Definitions
 *
 * Types matching the medias_products and medias_stock_movements database schema
 * Used by: Product management, inventory tracking, sales
 */

/**
 * Product type options (matches medias_tipo ENUM)
 */
export const PRODUCT_TYPES = ['Muslo', 'Panty', 'Rodilla'] as const
export type MediasProductType = (typeof PRODUCT_TYPES)[number]

/**
 * Size options (matches medias_talla ENUM)
 */
export const PRODUCT_SIZES = ['M', 'L', 'XL', 'XXL'] as const
export type MediasProductSize = (typeof PRODUCT_SIZES)[number]

/**
 * Stock movement types (matches medias_movement_type ENUM)
 */
export const MOVEMENT_TYPES = [
  'compra',
  'venta',
  'devolucion',
  'ajuste_entrada',
  'ajuste_salida',
  'transferencia'
] as const
export type MediasMovementType = (typeof MOVEMENT_TYPES)[number]

/**
 * Base product type from database Row.
 * Matches medias_products table schema exactly.
 */
export interface MediasProduct {
  id: string
  tipo: MediasProductType
  talla: MediasProductSize
  codigo: string
  precio: number
  stock_normal: number
  stock_devoluciones: number
  activo: boolean
  created_at: string
  updated_at: string
}

/**
 * Product insert type (for creating new products)
 */
export interface MediasProductInsert {
  tipo: MediasProductType
  talla: MediasProductSize
  codigo: string
  precio: number
  activo?: boolean
}

/**
 * Product update type (for editing existing products)
 * Only precio and activo are editable per research decisions
 */
export interface MediasProductUpdate {
  precio?: number
  activo?: boolean
}

/**
 * Stock movement type (immutable audit record)
 * Matches medias_stock_movements table schema
 */
export interface MediasStockMovement {
  id: string
  product_id: string
  tipo: MediasMovementType
  cantidad: number
  stock_normal_antes: number
  stock_normal_despues: number
  stock_devoluciones_antes: number
  stock_devoluciones_despues: number
  referencia_id: string | null
  referencia_tipo: string | null
  notas: string | null
  created_by: string
  created_at: string
}

/**
 * Helper type for product display with computed total stock
 */
export interface MediasProductWithTotalStock extends MediasProduct {
  stock_total: number
}

/**
 * Helper function to compute total stock
 */
export function computeTotalStock(product: MediasProduct): number {
  return product.stock_normal + product.stock_devoluciones
}
```

Follow the pattern from src/types/services.ts for structure and JSDoc comments.
  </action>
  <verify>File exports MediasProduct, MediasStockMovement, PRODUCT_TYPES, PRODUCT_SIZES, MOVEMENT_TYPES</verify>
  <done>Type definitions created matching database schema</done>
</task>

<task type="auto">
  <name>Task 2: Create Zod validation schemas</name>
  <files>src/lib/validations/medias/product.ts</files>
  <action>
Create directory src/lib/validations/medias/ if needed, then create product.ts:

```typescript
import { z } from 'zod'
import { PRODUCT_TYPES, PRODUCT_SIZES } from '@/types/medias/products'

/**
 * Schema for creating a new product
 * Note: tipo, talla, codigo are only editable on create
 */
export const mediasProductSchema = z.object({
  tipo: z.enum(PRODUCT_TYPES, {
    required_error: 'El tipo es requerido',
    invalid_type_error: 'Tipo invalido'
  }),
  talla: z.enum(PRODUCT_SIZES, {
    required_error: 'La talla es requerida',
    invalid_type_error: 'Talla invalida'
  }),
  codigo: z
    .string()
    .min(1, 'El codigo es requerido')
    .max(20, 'El codigo es muy largo')
    .regex(/^[A-Za-z0-9-]+$/, 'El codigo solo puede contener letras, numeros y guiones'),
  precio: z
    .number({ message: 'El precio es requerido' })
    .min(1, 'El precio debe ser mayor a 0')
    .max(10000000, 'El precio es muy alto'),
  activo: z.boolean().default(true),
})

/**
 * Schema for updating an existing product
 * Only precio and activo can be updated (tipo, talla, codigo are immutable)
 */
export const mediasProductUpdateSchema = z.object({
  precio: z
    .number({ message: 'El precio es requerido' })
    .min(1, 'El precio debe ser mayor a 0')
    .max(10000000, 'El precio es muy alto')
    .optional(),
  activo: z.boolean().optional(),
})

/**
 * TypeScript types inferred from schemas
 */
export type MediasProductFormData = z.infer<typeof mediasProductSchema>
export type MediasProductUpdateData = z.infer<typeof mediasProductUpdateSchema>
```

Follow the pattern from src/lib/validations/service.ts.
  </action>
  <verify>File exports mediasProductSchema, mediasProductUpdateSchema, MediasProductFormData</verify>
  <done>Zod schemas created for product validation</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Types file compiles without TypeScript errors
2. Validations file compiles without TypeScript errors
3. MediasProduct interface matches database columns
4. MediasStockMovement includes before/after snapshot fields
5. Zod schema validates tipo as enum, precio as positive number
</verification>

<success_criteria>
- [ ] src/types/medias/products.ts exists with MediasProduct, MediasStockMovement types
- [ ] src/lib/validations/medias/product.ts exists with Zod schemas
- [ ] PRODUCT_TYPES = ['Muslo', 'Panty', 'Rodilla']
- [ ] PRODUCT_SIZES = ['M', 'L', 'XL', 'XXL']
- [ ] MOVEMENT_TYPES includes compra, venta, devolucion, ajuste_entrada, ajuste_salida, transferencia
- [ ] Schema validates precio > 0 and codigo pattern
</success_criteria>

<output>
After completion, create `.planning/phases/10-medias-foundation/10-02-SUMMARY.md`
</output>
