---
phase: 01-security-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/middleware.ts
  - src/types/supabase.ts
  - .env.local.example
autonomous: true
user_setup:
  - service: supabase
    why: "Backend database, authentication, and storage"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon public key"
      - name: SUPABASE_SERVICE_ROLE_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> service_role key (keep secret)"
    dashboard_config:
      - task: "Create Supabase project"
        location: "https://supabase.com/dashboard -> New project"

must_haves:
  truths:
    - "Next.js 15 app runs with npm run dev"
    - "Supabase client can be imported from lib/supabase/client"
    - "Server client can be imported from lib/supabase/server"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "@supabase/ssr"
    - path: "src/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/middleware.ts"
      provides: "Middleware Supabase client"
      exports: ["createClient"]
  key_links:
    - from: "src/lib/supabase/client.ts"
      to: "NEXT_PUBLIC_SUPABASE_URL"
      via: "env variable"
      pattern: "process\\.env\\.NEXT_PUBLIC_SUPABASE_URL"
---

<objective>
Initialize Next.js 15 project with Supabase SSR authentication infrastructure.

Purpose: Establish the foundation codebase with properly configured Supabase clients for browser, server components, and middleware contexts.
Output: Working Next.js app with three Supabase client utilities ready for auth flows.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-security-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 15 project with dependencies</name>
  <files>package.json, tsconfig.json, next.config.ts, .env.local.example</files>
  <action>
Create Next.js 15 project with the following:

1. Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --no-import-alias` with automatic yes
2. Install Supabase dependencies: `npm install @supabase/supabase-js @supabase/ssr`
3. Create `.env.local.example` with placeholder env vars:
   ```
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   ```
4. Add `.env.local` to `.gitignore` if not already there

DO NOT install unnecessary dependencies. Keep it minimal: Next.js + Supabase + Tailwind.
  </action>
  <verify>
    - `npm run dev` starts without errors
    - `package.json` contains @supabase/ssr and @supabase/supabase-js
    - `.env.local.example` exists
  </verify>
  <done>Next.js 15 project initialized with Supabase dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client utilities</name>
  <files>src/lib/supabase/client.ts, src/lib/supabase/server.ts, src/lib/supabase/middleware.ts</files>
  <action>
Create three Supabase client utilities following @supabase/ssr patterns from 01-RESEARCH.md:

1. `src/lib/supabase/client.ts` - Browser client:
   ```typescript
   import { createBrowserClient } from '@supabase/ssr'

   export function createClient() {
     return createBrowserClient(
       process.env.NEXT_PUBLIC_SUPABASE_URL!,
       process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
     )
   }
   ```

2. `src/lib/supabase/server.ts` - Server Component client:
   - Use `createServerClient` from @supabase/ssr
   - Import cookies from 'next/headers'
   - Handle cookie operations with getAll/setAll pattern
   - Wrap setAll in try/catch (Server Components can't set cookies)

3. `src/lib/supabase/middleware.ts` - Middleware client:
   - Takes NextRequest and returns both client and response
   - Used by middleware.ts for token refresh
   - Handles cookie operations on both request and response

Follow exact patterns from 01-RESEARCH.md. Use async/await for cookies() in Next.js 15.
  </action>
  <verify>
    - All three files export `createClient` function
    - No TypeScript errors: `npx tsc --noEmit`
    - Files follow patterns from research
  </verify>
  <done>Three Supabase client utilities created following SSR best practices</done>
</task>

<task type="auto">
  <name>Task 3: Create TypeScript types placeholder</name>
  <files>src/types/supabase.ts, src/types/index.ts</files>
  <action>
Create TypeScript type definitions:

1. `src/types/supabase.ts` - Database types placeholder:
   ```typescript
   // Generated types will go here after running:
   // npx supabase gen types typescript --project-id <project-id> > src/types/supabase.ts

   export type Json =
     | string
     | number
     | boolean
     | null
     | { [key: string]: Json | undefined }
     | Json[]

   // Placeholder until schema is created
   export interface Database {
     public: {
       Tables: {
         // Tables will be generated
       }
       Views: {
         // Views will be generated
       }
       Functions: {
         // Functions will be generated
       }
       Enums: {
         // Enums will be generated
       }
     }
   }
   ```

2. `src/types/index.ts` - Re-export types:
   ```typescript
   export * from './supabase'

   // Application-specific types
   export type UserRole = 'admin' | 'medico' | 'enfermera' | 'secretaria' | 'none'
   ```

This creates the structure for generated types and app-specific types.
  </action>
  <verify>
    - `src/types/supabase.ts` exists with Database interface
    - `src/types/index.ts` exports UserRole type
    - No TypeScript errors
  </verify>
  <done>TypeScript types structure created ready for Supabase schema</done>
</task>

</tasks>

<verification>
1. Run `npm run dev` - should start without errors
2. Run `npx tsc --noEmit` - no TypeScript errors
3. Check all three Supabase client files exist with correct exports
4. Verify .env.local.example has all required placeholders
</verification>

<success_criteria>
- Next.js 15 development server runs
- Supabase client utilities can be imported without errors
- TypeScript compilation passes
- Environment variable placeholders documented
</success_criteria>

<output>
After completion, create `.planning/phases/01-security-foundation/01-01-SUMMARY.md`
</output>
