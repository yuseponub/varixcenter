---
phase: 02-patients
plan: 06
type: execute
wave: 4
depends_on: ["02-04"]
files_modified:
  - src/app/(protected)/pacientes/nuevo/page.tsx
  - src/app/(protected)/pacientes/[id]/editar/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can access /pacientes/nuevo to register a new patient"
    - "User can access /pacientes/[id]/editar to edit an existing patient"
    - "Create form shows all fields editable"
    - "Edit form shows cedula as disabled (read-only)"
    - "Both pages show breadcrumb navigation back to patient list"
  artifacts:
    - path: "src/app/(protected)/pacientes/nuevo/page.tsx"
      provides: "New patient registration page"
    - path: "src/app/(protected)/pacientes/[id]/editar/page.tsx"
      provides: "Patient edit page"
  key_links:
    - from: "src/app/(protected)/pacientes/nuevo/page.tsx"
      to: "src/components/patients/patient-form.tsx"
      via: "PatientForm component import"
      pattern: "PatientForm.*mode.*create"
    - from: "src/app/(protected)/pacientes/[id]/editar/page.tsx"
      to: "src/lib/queries/patients.ts"
      via: "getPatientById import"
      pattern: "getPatientById"
---

<objective>
Create new patient and edit patient pages using the PatientForm component

Purpose: Provides the UI pages for patient registration and editing. These pages wire together the form component (02-04) with server actions, completing the patient CRUD flow.
Output: Two pages accessible at /pacientes/nuevo and /pacientes/[id]/editar
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-patients/02-RESEARCH.md

# Form component from 02-04
@src/components/patients/patient-form.tsx

# Query functions from 02-03
@src/lib/queries/patients.ts

# Server actions from 02-04
@src/app/(protected)/pacientes/nuevo/actions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create new patient page</name>
  <files>src/app/(protected)/pacientes/nuevo/page.tsx</files>
  <action>
Create `src/app/(protected)/pacientes/nuevo/page.tsx`:

```typescript
import Link from 'next/link'
import { PatientForm } from '@/components/patients/patient-form'

export default function NuevoPacientePage() {
  return (
    <div className="container mx-auto py-6">
      {/* Breadcrumb */}
      <nav className="mb-6 text-sm text-gray-600">
        <Link href="/pacientes" className="hover:text-gray-900">
          Pacientes
        </Link>
        <span className="mx-2">/</span>
        <span className="text-gray-900">Nuevo Paciente</span>
      </nav>

      {/* Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold">Registrar Nuevo Paciente</h1>
        <p className="mt-1 text-gray-600">
          Complete el formulario para registrar un nuevo paciente en el sistema.
        </p>
      </div>

      {/* Form */}
      <div className="max-w-3xl">
        <PatientForm mode="create" />
      </div>
    </div>
  )
}
```

Key points:
1. Simple server component that renders PatientForm in create mode
2. Breadcrumb navigation back to patient list
3. Clear heading and description in Spanish
4. Max width container for better form readability
  </action>
  <verify>
Run `cat src/app/\(protected\)/pacientes/nuevo/page.tsx | grep -E "(PatientForm|mode.*create|Nuevo Paciente)"` - should show form import, create mode, and Spanish text.
  </verify>
  <done>
New patient page created with PatientForm in create mode and breadcrumb navigation
  </done>
</task>

<task type="auto">
  <name>Task 2: Create edit patient page</name>
  <files>src/app/(protected)/pacientes/[id]/editar/page.tsx</files>
  <action>
Create the directory if needed: `mkdir -p src/app/\(protected\)/pacientes/\[id\]/editar`

Create `src/app/(protected)/pacientes/[id]/editar/page.tsx`:

```typescript
import Link from 'next/link'
import { notFound } from 'next/navigation'
import { getPatientById } from '@/lib/queries/patients'
import { PatientForm } from '@/components/patients/patient-form'

interface PageProps {
  params: Promise<{ id: string }>
}

export default async function EditarPacientePage({ params }: PageProps) {
  const { id } = await params

  // Fetch patient data
  const patient = await getPatientById(id)

  if (!patient) {
    notFound()
  }

  // Convert database dates to form format (YYYY-MM-DD)
  const defaultValues = {
    cedula: patient.cedula,
    nombre: patient.nombre,
    apellido: patient.apellido,
    celular: patient.celular,
    email: patient.email ?? '',
    fecha_nacimiento: patient.fecha_nacimiento ?? '',
    direccion: patient.direccion ?? '',
    contacto_emergencia_nombre: patient.contacto_emergencia_nombre,
    contacto_emergencia_telefono: patient.contacto_emergencia_telefono,
    contacto_emergencia_parentesco: patient.contacto_emergencia_parentesco,
  }

  return (
    <div className="container mx-auto py-6">
      {/* Breadcrumb */}
      <nav className="mb-6 text-sm text-gray-600">
        <Link href="/pacientes" className="hover:text-gray-900">
          Pacientes
        </Link>
        <span className="mx-2">/</span>
        <Link href={`/pacientes/${id}`} className="hover:text-gray-900">
          {patient.nombre} {patient.apellido}
        </Link>
        <span className="mx-2">/</span>
        <span className="text-gray-900">Editar</span>
      </nav>

      {/* Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold">Editar Paciente</h1>
        <p className="mt-1 text-gray-600">
          Cedula: <span className="font-mono">{patient.cedula}</span>
          <span className="ml-2 text-xs text-amber-600">
            (La cedula no puede ser modificada)
          </span>
        </p>
      </div>

      {/* Form */}
      <div className="max-w-3xl">
        <PatientForm
          mode="edit"
          patientId={id}
          defaultValues={defaultValues}
        />
      </div>
    </div>
  )
}
```

Key points:
1. Server component fetches patient data before rendering
2. Uses notFound() for invalid patient IDs (returns 404)
3. Breadcrumb shows patient name and links back to detail page
4. Header clearly states cedula is immutable
5. Converts null values to empty strings for form compatibility
6. Passes patientId for the update server action
  </action>
  <verify>
Run `cat src/app/\(protected\)/pacientes/\[id\]/editar/page.tsx | grep -E "(getPatientById|mode.*edit|notFound|no puede ser modificada)"` - should show data fetching, edit mode, and immutability message.
  </verify>
  <done>
Edit patient page created with data pre-loading, edit mode form, and cedula immutability message
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` should pass
2. Navigate to /pacientes/nuevo should show registration form
3. Navigate to /pacientes/[valid-id]/editar should show edit form with pre-filled data
4. Navigate to /pacientes/[invalid-id]/editar should return 404
</verification>

<success_criteria>
- /pacientes/nuevo renders PatientForm in create mode
- /pacientes/[id]/editar renders PatientForm in edit mode with patient data
- Edit page shows cedula as disabled with explanation text
- Breadcrumb navigation works correctly on both pages
- Invalid patient ID returns 404 page
</success_criteria>

<output>
After completion, create `.planning/phases/02-patients/02-06-SUMMARY.md`
</output>
