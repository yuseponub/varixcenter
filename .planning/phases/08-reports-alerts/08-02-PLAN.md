---
phase: 08-reports-alerts
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/reports.ts
  - src/types/alerts.ts
  - src/lib/validations/alerts.ts
autonomous: true

must_haves:
  truths:
    - "Report types define income report structure"
    - "Alert types match database schema"
    - "Zod schemas validate alert resolution input"
  artifacts:
    - path: "src/types/reports.ts"
      provides: "IncomeReport, ReportFilters, ChartDataPoint types"
      exports: ["IncomeReport", "ReportFilters"]
    - path: "src/types/alerts.ts"
      provides: "Alert types, severity config, tipo labels"
      exports: ["Alert", "AlertSeveridad", "AlertTipo", "ALERT_SEVERIDAD_CONFIG"]
    - path: "src/lib/validations/alerts.ts"
      provides: "Zod schemas for alert resolution"
      exports: ["resolveAlertSchema"]
  key_links:
    - from: "src/types/alerts.ts"
      to: "database ENUM"
      via: "const arrays matching DB values"
      pattern: "ALERT_SEVERIDADES.*=.*\\['info', 'advertencia', 'critico'\\]"
---

<objective>
Create TypeScript types and Zod validation schemas for reports and alerts.

Purpose: Provides type safety for report data structures and alert operations, ensuring compile-time validation of data shapes.
Output: Complete type definitions for income reports and alerts, plus Zod schema for alert resolution.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-reports-alerts/08-CONTEXT.md
@.planning/phases/08-reports-alerts/08-RESEARCH.md

# Existing type patterns
@src/types/payments.ts (const arrays for enum values)
@src/types/cash-closing.ts (similar domain types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create report types</name>
  <files>src/types/reports.ts</files>
  <action>
Create src/types/reports.ts with:

1. ReportFilters interface:
   - startDate: string (YYYY-MM-DD format)
   - endDate: string (YYYY-MM-DD format)

2. IncomeReport interface (matches RPC return):
   - total_efectivo: number
   - total_tarjeta: number
   - total_transferencia: number
   - total_nequi: number
   - total_descuentos: number
   - total_anulaciones: number
   - grand_total: number
   - payment_count: number
   - citas_atendidas: number

3. ChartDataPoint interface (for Recharts):
   - date: string (display label)
   - efectivo: number
   - tarjeta: number
   - transferencia: number
   - nequi: number

4. DailyIncomeData interface (for daily breakdown):
   - fecha: string (YYYY-MM-DD)
   - efectivo: number
   - tarjeta: number
   - transferencia: number
   - nequi: number
   - total: number

5. ReportPeriod type: 'diario' | 'mensual' | 'rango'

6. Helper function formatCurrency(amount: number): string
   - Returns formatted COP currency string (e.g., "$50,000")
   - Use Intl.NumberFormat with 'es-CO' locale, COP currency, no decimals

Export all types and the helper function.
  </action>
  <verify>
- File exists: `ls src/types/reports.ts`
- Has all interfaces: `grep -c "export interface" src/types/reports.ts` shows 4
- Has ReportPeriod type: `grep "ReportPeriod" src/types/reports.ts`
- Has formatCurrency: `grep "formatCurrency" src/types/reports.ts`
  </verify>
  <done>Report types created with IncomeReport, ReportFilters, ChartDataPoint, and currency formatter</done>
</task>

<task type="auto">
  <name>Task 2: Create alert types with severity configuration</name>
  <files>src/types/alerts.ts</files>
  <action>
Create src/types/alerts.ts with:

1. Const arrays matching database ENUMs:
   - ALERT_SEVERIDADES = ['info', 'advertencia', 'critico'] as const
   - ALERT_TIPOS = ['pago_anulado', 'diferencia_cierre'] as const

2. Derived types:
   - AlertSeveridad = (typeof ALERT_SEVERIDADES)[number]
   - AlertTipo = (typeof ALERT_TIPOS)[number]

3. Alert interface (matches database schema):
   - id: string
   - tipo: AlertTipo
   - severidad: AlertSeveridad
   - titulo: string
   - descripcion: string
   - referencia_tipo: string | null
   - referencia_id: string | null
   - resuelta: boolean
   - resuelta_por: string | null
   - resuelta_at: string | null
   - resuelta_notas: string | null
   - created_at: string

4. ALERT_SEVERIDAD_CONFIG record (for UI styling):
   ```typescript
   Record<AlertSeveridad, {
     label: string
     variant: 'secondary' | 'outline' | 'destructive'
     icon: 'Info' | 'AlertTriangle' | 'AlertCircle'
     bgColor: string
   }>
   ```
   - info: label 'Informativo', variant 'secondary', icon 'Info', bgColor 'bg-blue-50'
   - advertencia: label 'Advertencia', variant 'outline', icon 'AlertTriangle', bgColor 'bg-yellow-50'
   - critico: label 'Critico', variant 'destructive', icon 'AlertCircle', bgColor 'bg-red-50'

5. ALERT_TIPO_LABELS record:
   - pago_anulado: 'Pago Anulado'
   - diferencia_cierre: 'Diferencia en Cierre'

6. Type guard function isValidAlertSeveridad(value: unknown): value is AlertSeveridad

Export all types, constants, and functions.
  </action>
  <verify>
- File exists: `ls src/types/alerts.ts`
- Has const arrays: `grep -c "as const" src/types/alerts.ts` shows 2
- Has interface: `grep "export interface Alert" src/types/alerts.ts`
- Has config: `grep "ALERT_SEVERIDAD_CONFIG" src/types/alerts.ts`
- Has labels: `grep "ALERT_TIPO_LABELS" src/types/alerts.ts`
  </verify>
  <done>Alert types created with severity config for UI styling and type guards</done>
</task>

<task type="auto">
  <name>Task 3: Create Zod validation schema for alert resolution</name>
  <files>src/lib/validations/alerts.ts</files>
  <action>
Create src/lib/validations/alerts.ts with:

1. Import z from 'zod'
2. Import ALERT_SEVERIDADES, ALERT_TIPOS from '@/types/alerts'

3. resolveAlertSchema:
   - alertId: z.string().uuid()
   - notas: z.string().min(1, { message: 'Las notas son requeridas' }).max(500)

4. alertFilterSchema (for query params):
   - resuelta: z.boolean().optional()
   - tipo: z.enum(ALERT_TIPOS).optional()
   - severidad: z.enum(ALERT_SEVERIDADES).optional()

5. Export schemas and inferred types:
   - ResolveAlertInput = z.infer<typeof resolveAlertSchema>
   - AlertFilterInput = z.infer<typeof alertFilterSchema>

Follow Zod v4 API patterns from existing validations (use { message: } not { required_error: } per 10-02 decision).
  </action>
  <verify>
- File exists: `ls src/lib/validations/alerts.ts`
- Has schemas: `grep -c "z\\.object" src/lib/validations/alerts.ts` shows at least 2
- Has exports: `grep -c "export" src/lib/validations/alerts.ts` shows at least 3
- Uses Zod v4 syntax: `grep "message:" src/lib/validations/alerts.ts`
  </verify>
  <done>Alert validation schemas created with resolveAlertSchema and alertFilterSchema</done>
</task>

</tasks>

<verification>
1. Types compile: `npx tsc --noEmit src/types/reports.ts src/types/alerts.ts`
2. Validations import correctly: `npx tsc --noEmit src/lib/validations/alerts.ts`
3. All exports are accessible
</verification>

<success_criteria>
- src/types/reports.ts with IncomeReport, ReportFilters, ChartDataPoint, formatCurrency
- src/types/alerts.ts with Alert, AlertSeveridad, AlertTipo, ALERT_SEVERIDAD_CONFIG
- src/lib/validations/alerts.ts with resolveAlertSchema, alertFilterSchema
- All types match database schema from migration 027
- Severity config provides variant/icon/bgColor for UI components
</success_criteria>

<output>
After completion, create `.planning/phases/08-reports-alerts/08-02-SUMMARY.md`
</output>
